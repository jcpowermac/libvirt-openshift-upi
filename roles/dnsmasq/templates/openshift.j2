# TODO
######
# etcd dns
# api addresses for lb
# workers
# masters



{% for lb in groups['lb'] %}
address=api.{{ cluster_domain }}/{{ hostvars[lb]['ip'] }}
address=api-int.{{ cluster_domain }}/{{ hostvars[lb]['ip'] }}
address=/.apps.{{ cluster_domain }}/{{ hostvars[lb]['ip'] }}
{% endfor %}


{% for master in groups['masters'] %}
address=etcd-{{ loop.index }}.{{ cluster_domain }}/{{ hostvars[master]['ip'] }}
{% endfor %}


{% for master in groups['masters'] %}
srv-host=_etcd-server-ssl._tcp.{{ cluster_domain }},etcd-{{ loop.index }}.{{ cluster_domain }},2380
{% endfor %}

{% for boot in groups['bootstrap'] %}


    server boot {{ hostvars[boot]['ip'] }}:6443 check
{% endfor %}
{% for master in groups['masters'] %}
    server master-{{ loop.index }} {{ hostvars[master]['ip'] }}:6443 check
{% endfor %}

{% for worker in groups['workers'] %}
    server worker-{{ loop.index }} {{ hostvars[worker]['ip'] }}:80 check
{% endfor %}


_etcd-server-ssl._tcp   SRV     0 10 2380 etcd-0
                        SRV     0 10 2380 etcd-1
SRV     0 10 2380 etcd-2
